# type detection and annotation utilities